%
% uebung.tex -- gemeinsame Makros fuer Uebungsblaetter
%
% (c) 2006-2017 Prof. Dr. Andreas Mueller, HSR
%
\newcounter{uebungsaufgabe}
\newboolean{loesungen}
% environment fuer uebungsaufgaben
\newenvironment{uebungsaufgaben}{
\begin{list}{\arabic{uebungsaufgabe}.}
  {\usecounter{uebungsaufgabe}
  \setlength{\labelwidth}{2cm}
  \setlength{\leftmargin}{0pt}
  \setlength{\labelsep}{5mm}
  \setlength{\rightmargin}{0pt}
  \setlength{\itemindent}{0pt}
}}{\end{list}\vfill\pagebreak}
% Teilaufgaben
\newenvironment{teilaufgaben}{
\begin{enumerate}
\renewcommand{\labelenumi}{\alph{enumi})}
}{\end{enumerate}}
% Loesung
\NewEnviron{loesung}{%
\begin{proof}[LÃ¶sung]%
\renewcommand{\qedsymbol}{$\bigcirc$}
\BODY
\end{proof}}
\NewEnviron{diskussion}{
\BODY
\bigskip
}
\def\keineloesungen{%
\RenewEnviron{loesung}{\relax}
\RenewEnviron{diskussion}{\relax}
}
% Hinweis
\newenvironment{hinweis}{%
\renewcommand{\qedsymbol}{}
\begin{proof}[Hinweis]}{\end{proof}}
% Aufgabe aus der Sammlung wiedergeben
\newboolean{themastatus}
\setboolean{themastatus}{false}
\newcounter{problemcounter}[chapter]
\def\aufgabepath{./}
\def\ainput#1{\input\aufgabepath/#1}
\def\verbatimainput#1{\expandafter\verbatiminput{\aufgabepath/#1}}
\def\aufgabetoplevel#1{%
\expandafter\def\expandafter\inputpath{#1}%
\let\aufgabepath=\inputpath
}
\def\includeagraphics[#1]#2{\expandafter\includegraphics[#1]{\aufgabepath#2}}
% \aufgabe
\newcommand{\aufgabe}[2]{%
  \expandafter\def\csname themalist\endcsname{}
  \setboolean{themastatus}{false}
  \refstepcounter{problemcounter}%
  \label{#2}
  \bigskip{\parindent0pt\strut}\hbox{\bf\theproblemcounter. }%
  \marginpar{\raggedright\tiny #2}%
  \expandafter\def\csname currentaufgabe\endcsname{#2}%
  \expandafter\def\csname aufgabepath\endcsname{\inputpath/#1/#2/}%
  \expandafter\input{\inputpath#1/#2.tex}
  %\medskip
  \ifthenelse{\boolean{themastatus}}{
    \parindent 0pt
    {\sc Thema:} {\small \themalist.}}{%
  }
  \bigskip

}
\renewcommand\theproblemcounter{\thechapter.\arabic{problemcounter}}
% Bewertung
\NewEnviron{bewertung}{\footnotesize
\renewcommand{\qedsymbol}{}
\begin{proof}[Bewertung]
\BODY
\end{proof}}
% oft benutzte Macros
\def\blank{\text{\textvisiblespace}}
%
% macros fuer den thema-Index
%
\newcommand{\openthemaindex}{%
  \newwrite\themaindex
  \immediate\openout\themaindex=thema.tix
}
%
\newcommand{\closethemaindex}{\immediate\closeout\themaindex}
%
\def\themalink#1{\hyperref[thema:#1]{#1}}
\def\thema#1{%
  \ifthenelse{\boolean{themastatus}}{%
    \xappto{\themalist}{, \noexpand\themalink{#1}}
  }{%
    \xdef\themalist{\noexpand\themalink{#1}}
    \setboolean{themastatus}{true}
  }
  \immediate\write\themaindex%
  {{\thechapter}{#1}{\arabic{problemcounter}}{\thechapter.\arabic{problemcounter}}{\currentaufgabe}}%
}
% Thema-Information anzeigen
\def\themasection#1#2{ \item[#1]\label{thema:#1} #2 }
\newcommand{\printthemata}{
  \IfFileExists{./thema.tex}{
    \chapter*{Aufgaben nach Themen}
    \begin{description}
    \input{thema.tex}
    \end{description}
  }{}
}
